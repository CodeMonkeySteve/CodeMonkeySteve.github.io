<p>Finished my first stab at converting my current toy project from ActiveRecord to CouchDB, and so far so good.  I ran into an issue where associations aren&#8217;t getting saved, but I&#8217;m most likely just doing something stupid.</p>
<p>One minor annoyance is that, unlike ActiveRecord, the test database doesn&#8217;t get purged and after a while can get cluttered with randomly-generated fixtures<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>.  No problem, just drop in this little Rake task to recreate the DB on each run:</p>
<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/tasks/couchdb.rake</span>
<span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span> <span class="no">RAILS_ROOT</span> <span class="o">+</span> <span class="s1">'/config/environment'</span> <span class="p">)</span>
<span class="nb">require</span> <span class="s1">'couch_potato'</span>

<span class="n">task</span> <span class="s1">'couchdb:test:purge'</span>  <span class="k">do</span>
  <span class="no">CouchPotato</span><span class="o">::</span><span class="no">Config</span><span class="p">.</span><span class="nf">database_name</span> <span class="o">=</span>
    <span class="no">YAML</span><span class="o">::</span><span class="nb">load</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'/config/couchdb.yml'</span><span class="p">))[</span><span class="s1">'test'</span><span class="p">]</span>
  <span class="no">CouchPotato</span><span class="p">.</span><span class="nf">couchrest_database</span><span class="p">.</span><span class="nf">recreate!</span>
<span class="k">end</span>
<span class="n">task</span> <span class="s1">'db:test:purge'</span> <span class="o">=&gt;</span> <span class="s1">'couchdb:test:purge'</span></code></pre></figure><p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> <span class="caps">BTW</span>, have I mentioned how cool <a href="http://github.com/thoughtbot/factory_girl">factory_girl</a> is?  Another new tool for my bag of tricks.</p>